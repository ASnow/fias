# Федеральная Информационная Адресная Система (ФИАС)

Для работы с базой потребуются файлы полной БД ФИАС в формате DBF. Скачать их можно по адресу:

    http://fias.nalog.ru/Public/DownloadPage.aspx

Там же можно скачать описание структуры базы.

# Установка и подготовка базы

1. Подключить гем

```
gem 'fias', git: 'https://github.com/evilmartians/kladr.git'
```

1. Скачать и распаковать базу ФИАС в tmp/fias (по умолчанию)

# Создание таблиц в базе данных

Возможны два варианта:

```
rake fias:create_tables [DATABASE_URL=... PREFIX=... PATH=...]
```

Либо:

```
rails g fias:migration [--path=... --prefix=...]
```

Первый вариант - для использования гема вне рельсов, либо для случая, когда
актуальная база ФИАС будет использоваться только для локального мапинга, и
на продакшн попасть не должна.

# Импорт данных

```
rake fias:import:placements fias:import:houses PREFIX=fias PATH=tmp/fias
```

Импорт данных разделен на два шага, по скольку, не всегда нужны данные
о строениях, а их почти в 20 раз больше, чем остальных. В большинстве случаев
достаточно городов и улиц.

# Некоторые замечания про ФИАС

1. ФИАС хранит историю изменений информации адресных объектов. Например,
в ней есть и Ленинград и Санкт-Петербург. Исторические версии это
двунаправленный список.
1. Записи базы данных ФИАС имеют признак актуальности.
1. Ленинград и Санкт-Петербург, хотя, и хранятся в разных записях базы данных,
являются одним и тем же территориальным образованием. Код территориального
образования хранится в поле AOGUID. Из внешних таблиц логично ссылаться
на AOGUID, а не на AOID.

# Работа с данными

Существующие регионы:

```
Fias::AddressObject.actual.leveled(:region).all
```

Подчиненные объекты в регионе (области, районы, столица региона):

```
region = Fias::AddressObject.actual.leveled(:region).first
region.children.actual
```

# TODO

1. Индексы.

# Полезные ссылки

* http://fias.nalog.ru/Public/DownloadPage.aspx
* http://wiki.gis-lab.info/w/%D0%A4%D0%98%D0%90%D0%A1#.D0.A2.D0.B5.D0.BA.D1.81.D1.82.D0.BE.D0.B2.D1.8B.D0.B5_.D1.8D.D0.BB.D0.B5.D0.BC.D0.B5.D0.BD.D1.82.D1.8B_.D0.B0.D0.B4.D1.80.D0.B5.D1.81.D0.B0
* http://basicdata.ru
